"use strict";document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("introView"),o=(document.getElementById("solverView"),document.getElementById("gridView")),e=o.getContext("2d"),l=document.getElementById("startButton"),s=document.getElementById("width"),n=document.getElementById("height");let c=null;const i=e=>{t.hidden=!0,o.hidden=!1,c=e,r(),h(!0)},f=t=>{localStorage.setItem("game",JSON.stringify(t))},r=()=>{for(let t=0;t<c.config.width;t++)c.status.cols[t]=g(t);for(let t=0;t<c.config.height;t++)c.status.rows[t]=a(t)},g=t=>{if(c.cols[t].length<1)return 0;let o=0,e=0,l=[];for(const e of c.cols[t])e>0&&(o+=e);let s=!1,n=0;for(const o of c.grid)1===o[t]?(s=!0,n++,e++):s&&(l.push(n),n=0,s=!1);return s&&l.push(n),e>o?-65535:e<o?0:l.join("-")===c.cols[t].join("-")?65535:-65535},a=t=>{if(c.rows[t].length<1)return 0;let o=0,e=0,l=[];for(const e of c.rows[t])e>0&&(o+=e);let s=!1,n=0;for(const o of c.grid[t])1===o?(s=!0,n++,e++):s&&(l.push(n),n=0,s=!1);return s&&l.push(n),e>o?-65535:e<o?0:l.join("-")===c.rows[t].join("-")?65535:-65535},d=()=>{const t=s.value;localStorage.setItem("width",t);const o=n.value;localStorage.setItem("height",o),((t,o)=>{const e={cols:[],config:{height:o,scale:10,width:t,xOffset:10,yOffset:10},grid:[],rows:[],status:{cols:[],rows:[],global:0}};for(let o=0;o<t;o++)e.cols[o]=[],e.status.cols[o]=0;for(let l=0;l<o;l++){e.rows[l]=[],e.status.rows[l]=0,e.grid[l]=[];for(let o=0;o<t;o++)e.grid[l][o]=-1}f(e),i(e)})(+t,+o)},h=t=>{(t=>{let o=1,e=1;for(const t of c.cols)t.length>o&&(o=t.length);for(const t of c.rows)t.length>e&&(e=t.length);if(t){const t=(window.innerWidth-10)/(e+c.config.width),l=(window.innerHeight-10)/(o+c.config.height);c.config.scale=Math.floor(t<l?t:l),c.config.scale<5&&(c.config.scale=5)}c.config.xOffset=c.config.scale*e,c.config.yOffset=c.config.scale*o})(t),o.width=c.config.xOffset+c.config.width*c.config.scale,o.height=c.config.yOffset+c.config.height*c.config.scale,e.clearRect(0,0,o.width,o.height);for(let t=0;t<c.config.width;t++)w(t);for(let t=0;t<c.config.height;t++)m(t);u()},u=()=>{for(let t=0;t<c.config.height;t++)for(let o=0;o<c.config.width;o++)v(o,t,c.grid[t][o])},w=t=>{const o=c.config.scale/2;let l=c.config.yOffset-c.cols[t].length*c.config.scale+o;const s=c.config.xOffset+t*c.config.scale+o;e.fillStyle=1&t?"#FFF":"#CCC",e.fillRect(s-o,0,c.config.scale,c.config.yOffset),e.font=.8*c.config.scale+"px Monospace",e.textAlign="center",e.textBaseline="middle";const n=c.status.cols[t]>0?"gray":"red",i=c.status.cols[t]>0?c.status.cols[t]:-c.status.cols[t];let f=1;for(let o of c.cols[t])e.fillStyle=i&f?n:"black",e.fillText(""+o,s,l),f*=2,l+=c.config.scale},m=t=>{const o=c.config.scale/2,l=c.config.yOffset+t*c.config.scale+o;let s=c.config.xOffset-c.rows[t].length*c.config.scale+o;e.fillStyle=1&t?"#FFF":"#CCC",e.fillRect(0,l-o,c.config.xOffset,c.config.scale),e.font=.8*c.config.scale+"px Monospace",e.textAlign="center",e.textBaseline="middle";const n=c.status.rows[t]>0?"gray":"red",i=c.status.rows[t]>0?c.status.rows[t]:-c.status.rows[t];let f=1;for(let o of c.rows[t])e.fillStyle=i&f?n:"black",e.fillText(""+o,s,l),f*=2,s+=c.config.scale},v=(t,o,l)=>{if(t<0||o<0||t>=c.config.width||o>=c.config.height)throw new Error("Outside game-grid: "+JSON.stringify({x:t,y:o,type:l}));const s=c.config.xOffset+t*c.config.scale,n=c.config.yOffset+o*c.config.scale;e.fillStyle="#808080",e.fillRect(s,n,c.config.scale,c.config.scale),e.fillStyle="#C0C0C0",e.fillRect(s,n,c.config.scale-1,c.config.scale-1),e.fillStyle="#404040",e.fillRect(s+1,n+1,c.config.scale-1,c.config.scale-1),e.fillStyle=l<0?"#808080":l?"black":"white",e.fillRect(s+1,n+1,c.config.scale-2,c.config.scale-2)},y=t=>{const o=Math.floor((t.clientX-c.config.xOffset)/c.config.scale),e=Math.floor((t.clientY-c.config.yOffset)/c.config.scale);if(o<0){if(e<0&&confirm("Reset game?"))return void h(!0);const t=c.rows[e].join(" "),o=prompt("Config row "+(1+e),t);if(null===o||t===o)return;if(""===o)return c.rows[e].length=0,void f(c);const l=o.split(/[ ,]+/g),s=[];let n=0;for(const t of l){const o=Math.floor(+t);o>0&&s.push(o),n+=o}return s.length<1?(console.error("Invalid row: "+o),void alert("Invalid row: "+o)):n+s.length>c.config.width+1?(console.error("Invalid row-size: "+o),console.error({newList:s,width:c.config.width,sum:n,length:s.length,max:n+s.length-1}),void alert("Invalid row-size: "+o)):(c.rows[e]=s,f(c),c.status.rows[e]=a(e),void m(e))}if(e<0){const t=c.cols[o].join(" "),e=prompt("Config col "+(1+o),t);if(null===e||t===e)return;if(""===e)return c.cols[o].length=0,void f(c);const l=e.split(/[ ,]+/g),s=[];let n=0;for(const t of l){const o=Math.floor(+t);o>0&&s.push(o),n+=o}return s.length<1?(console.error("Invalid col: "+e),void alert("Invalid col: "+e)):n+s.length>c.config.height+1?(console.error("Invalid col-size: "+e),console.error(s),void alert("Invalid col-size: "+e)):(c.cols[o]=s,f(c),c.status.cols[o]=g(o),void w(o))}const l=(1+c.grid[e][o]+(t.button>0?1:2))%3-1;c.grid[e][o]=l,f(c),v(o,e,l);const s=g(o);c.status.cols[o]!==s&&(c.status.cols[o]=s,w(o));const n=a(e);c.status.rows[e]!==n&&(c.status.rows[e]=n,m(e))};(()=>{const t=localStorage.getItem("width"),o=localStorage.getItem("height"),e=localStorage.getItem("game");if(t&&(s.value=t),o&&(n.value=o),e){const t=JSON.parse(e);i(t)}})(),l.addEventListener("click",d,{once:!1,passive:!0}),o.addEventListener("click",y,{once:!1,passive:!0})},{once:!0,passive:!0});
//# sourceMappingURL=es6.js.map
