"use strict";document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("introView"),e=(document.getElementById("solverView"),document.getElementById("gridView")),n=e.getContext("2d"),o=document.getElementById("startButton"),s=document.getElementById("width"),i=document.getElementById("height");let l=null;const c=n=>{t.hidden=!0,e.hidden=!1,l=n,f(),y(!0),window.game=l},r=t=>{localStorage.setItem("game",JSON.stringify(t))},a=()=>{let t=!0,e=!0;for(const n of l.status.cols){if(n<0){t=!1,e=!1;break}65535!==n&&(e=!1)}for(const n of l.status.rows){if(n<0){t=!1,e=!1;break}65535!==n&&(e=!1)}return l.status.global=t?e?65535:0:-65535,l.status.global},f=()=>{for(let t=0;t<l.config.width;t++)l.status.cols[t]=w(t);for(let t=0;t<l.config.height;t++)l.status.rows[t]=x(t);a()};window.nano=window.nano||{},window.nano.statusAll=f;const g=t=>{let e=t;for(;e.next;)m(e),e.next.start.min<=e.end.min&&(e.next.start.min=e.end.min+1),e.next.start.max>e.end.max+1&&(e.next.start.max=e.end.max+1),e=e.next;m(e)},d=t=>{let e=t;for(;e.prev;)m(e),e.prev.end.max>=e.start.max&&(e.prev.end.max=e.start.max-1),e.prev.end.min<e.start.min-1&&(e.prev.end.min=e.start.min-1),e=e.prev;m(e)},h=(t,e,n)=>{if(-1===e)return;if(n.type===e){const e=[];for(const o of n.possibilities)t!==o.start-1&&t!==o.end+1&&e.push(o);return void(e.length<n.possibilities.length&&(n.possibilities=e))}const o=[];for(const e of n.possibilities)e.start<=t&&t<=e.end||o.push(e);o.length<n.possibilities.length&&(n.possibilities=o)},m=t=>{const e={max:-1/0,min:1/0},n={end:{max:-1/0,min:1/0},start:{max:-1/0,min:1/0}},o=[];for(const s of t.possibilities){const i=s.end+1-s.start;s.start<t.start.min||(s.start>t.start.max||s.end<t.end.min||s.end>t.end.max||i<t.length.min||i>t.length.max||(o.push(s),s.start<n.start.min&&(n.start.min=s.start),s.start>n.start.max&&(n.start.max=s.start),s.end<n.end.min&&(n.end.min=s.end),s.end>n.end.max&&(n.end.max=s.end),i<e.min&&(e.min=i),i>e.max&&(e.max=i)))}o.length<t.possibilities.length&&(t.possibilities=o),t.possibilities.length>0&&(t.start=n.start,t.end=n.end,t.length=e)},u=(t,e)=>{const n=[];let o=0;for(const e of t)o+=e;let s=e.length-o-t.length+1;const i={end:{max:s-1,min:-1},length:{max:s,min:0},next:null,possibilities:[],prev:null,start:{max:0,min:0},type:0};n.push(i);let l=i,c=i;for(const e of t){const t=l.start.min+l.length.min;c={end:{max:t+e-1+s,min:t+e-1},length:{max:e,min:e},next:null,possibilities:[],prev:l,start:{max:t+s,min:t},type:1},l.next=c,n.push(c);const o=c.end.min+1;l={end:{max:o+s,min:o},length:{max:1+s,min:1},next:null,possibilities:[],prev:c,start:{max:o+s,min:o},type:0},c.next=l,n.push(l)}l.length.min--,l.length.max--,l.end.max--,l.end.min=l.end.max;for(const t of n)for(let e=t.start.min;e<=t.start.max;e++)for(let n=t.length.min;n<=t.length.max;n++){const o=e+n-1;t.end.min<=o&&o<=t.end.max&&t.possibilities.push({end:o,start:e})}g(i),d(l);for(const t of n)for(let n=0;n<e.length;n++)h(n,e[n],t);g(i),d(l);let r=1,a=0,f=!0;for(const t of n){const n=t.possibilities.length;if(n<1)return-65535;if(0===t.type)continue;let o=1===n;if(o){const n=t.possibilities[0];for(let s=n.start;s<=n.end;s++)if(e[s]!==t.type){o=!1;break}}o?a|=r:f=!1,r*=2}return f?65535:a},w=t=>{if(l.cols[t].length<1)return 0;const e=[];for(const n of l.grid)e.push(n[t]);return u(l.cols[t],e)},x=t=>l.rows[t].length<1?0:u(l.rows[t],l.grid[t]),p=()=>{const t=s.value;localStorage.setItem("width",t);const e=i.value;localStorage.setItem("height",e),((t,e)=>{const n={cols:[],config:{height:e,scale:10,width:t,xOffset:10,yOffset:10},grid:[],rows:[],status:{cols:[],rows:[],global:0}};for(let e=0;e<t;e++)n.cols[e]=[],n.status.cols[e]=0;for(let o=0;o<e;o++){n.rows[o]=[],n.status.rows[o]=0,n.grid[o]=[];for(let e=0;e<t;e++)n.grid[o][e]=-1}r(n),c(n)})(+t,+e)},y=t=>{(t=>{let e=1,n=1;for(const t of l.cols)t.length>e&&(e=t.length);for(const t of l.rows)t.length>n&&(n=t.length);if(t){const t=(window.innerWidth-10)/(n+l.config.width),o=(window.innerHeight-10)/(e+l.config.height);l.config.scale=Math.floor(t<o?t:o),l.config.scale<5&&(l.config.scale=5)}l.config.xOffset=l.config.scale*n,l.config.yOffset=l.config.scale*e})(t),e.width=l.config.xOffset+l.config.width*l.config.scale,e.height=l.config.yOffset+l.config.height*l.config.scale,n.clearRect(0,0,e.width,e.height),v();for(let t=0;t<l.config.width;t++)O(t);for(let t=0;t<l.config.height;t++)I(t);b()};window.nano=window.nano||{},window.nano.redraw=y;const v=()=>{l.status.global?n.fillStyle=l.status.global<0?"#FCC":"#CFC":n.fillStyle="white",n.fillRect(0,0,l.config.xOffset,l.config.yOffset)},b=()=>{for(let t=0;t<l.config.height;t++)for(let e=0;e<l.config.width;e++)S(e,t,l.grid[t][e])},O=t=>{const e=l.config.scale/2;let o=l.config.yOffset-l.cols[t].length*l.config.scale+e;const s=l.config.xOffset+t*l.config.scale+e;n.fillStyle=1&t?"#FFF":"#CCC",n.fillRect(s-e,0,l.config.scale,l.config.yOffset),n.font=.8*l.config.scale+"px Monospace",n.textAlign="center",n.textBaseline="middle";const i=l.status.cols[t]>0?"gray":"red",c=l.status.cols[t]>0?l.status.cols[t]:-l.status.cols[t];let r=1;for(let e of l.cols[t])n.fillStyle=c&r?i:"black",n.fillText(""+e,s,o),r*=2,o+=l.config.scale},I=t=>{const e=l.config.scale/2,o=l.config.yOffset+t*l.config.scale+e;let s=l.config.xOffset-l.rows[t].length*l.config.scale+e;n.fillStyle=1&t?"#FFF":"#CCC",n.fillRect(0,o-e,l.config.xOffset,l.config.scale),n.font=.8*l.config.scale+"px Monospace",n.textAlign="center",n.textBaseline="middle";const i=l.status.rows[t]>0?"gray":"red",c=l.status.rows[t]>0?l.status.rows[t]:-l.status.rows[t];let r=1;for(let e of l.rows[t])n.fillStyle=c&r?i:"black",n.fillText(""+e,s,o),r*=2,s+=l.config.scale},S=(t,e,o)=>{if(t<0||e<0||t>=l.config.width||e>=l.config.height)throw new Error("Outside game-grid: "+JSON.stringify({x:t,y:e,type:o}));const s=l.config.xOffset+t*l.config.scale,i=l.config.yOffset+e*l.config.scale;n.fillStyle="#808080",n.fillRect(s,i,l.config.scale,l.config.scale),n.fillStyle="#C0C0C0",n.fillRect(s,i,l.config.scale-1,l.config.scale-1),n.fillStyle="#404040",n.fillRect(s+1,i+1,l.config.scale-1,l.config.scale-1),n.fillStyle=o<0?"#808080":o?"black":"white",n.fillRect(s+1,i+1,l.config.scale-2,l.config.scale-2)},C=t=>{const e=Math.floor((t.clientX-l.config.xOffset)/l.config.scale),n=Math.floor((t.clientY-l.config.yOffset)/l.config.scale);return e<0?n<0?(t=>{t.ctrlKey&&confirm("Delete game?")?(localStorage.removeItem("game"),location.reload()):t.shiftKey&&confirm("Reset game?")?(r((t=>{t.grid=[],t.status={cols:[],rows:[],global:0};for(let e=0;e<t.config.width;e++)t.status.cols[e]=0;for(let e=0;e<t.config.height;e++){t.status.rows[e]=0,t.grid[e]=[];for(let n=0;n<t.config.width;n++)t.grid[e][n]=-1}return t})(l)),location.reload()):c(l)})(t):((t,e)=>{if(l.rows[t].length>0&&!e)return;const n=l.rows[t].join(" "),o=prompt("Config row "+(1+t),n);if(null===o||n===o)return;if(""===o)return l.rows[t].length=0,void r(l);const s=o.split(/[ ,]+/g),i=[];let c=0;for(const t of s){const e=Math.floor(+t);e>0&&i.push(e),c+=e}return i.length<1?(console.error("Invalid row: "+o),void alert("Invalid row: "+o)):c+i.length>l.config.width+1?(console.error("Invalid row-size: "+o),console.error({newList:i,width:l.config.width,sum:c,length:i.length,max:c+i.length-1}),void alert("Invalid row-size: "+o)):(l.rows[t]=i,r(l),l.status.rows[t]=x(t),void I(t))})(n,t.shiftKey||t.ctrlKey):n<0?((t,e)=>{if(l.cols[t].length>0&&!e)return;const n=l.cols[t].join(" "),o=prompt("Config col "+(1+t),n);if(null===o||n===o)return;if(""===o)return l.cols[t].length=0,void r(l);const s=o.split(/[ ,]+/g),i=[];let c=0;for(const t of s){const e=Math.floor(+t);e>0&&i.push(e),c+=e}return i.length<1?(console.error("Invalid col: "+o),void alert("Invalid col: "+o)):c+i.length>l.config.height+1?(console.error("Invalid col-size: "+o),console.error(i),void alert("Invalid col-size: "+o)):(l.cols[t]=i,r(l),l.status.cols[t]=w(t),void O(t))})(e,t.shiftKey||t.ctrlKey):((t,e,n)=>{const o=(1+l.grid[e][t]+(n?1:2))%3-1;l.grid[e][t]=o,r(l),S(t,e,o);const s=l.status.global,i=w(t);l.status.cols[t]!==i&&(l.status.cols[t]=i,O(t));const c=x(e);l.status.rows[e]!==c&&(l.status.rows[e]=c,I(e)),s!==a()&&v()})(e,n,t.button>0||t.shiftKey)};(()=>{const t=localStorage.getItem("width"),e=localStorage.getItem("height"),n=localStorage.getItem("game");if(t&&(s.value=t),e&&(i.value=e),n){const t=JSON.parse(n);c(t)}})(),o.addEventListener("click",p,{once:!1,passive:!0}),e.addEventListener("click",C,{once:!1,passive:!0})},{once:!0,passive:!0});
//# sourceMappingURL=es6.js.map
