"use strict";var __awaiter=function(t,e,n,o){return new(n||(n=Promise))((function(i,s){function l(t){try{f(o.next(t))}catch(t){s(t)}}function c(t){try{f(o.throw(t))}catch(t){s(t)}}function f(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(l,c)}f((o=o.apply(t,e||[])).next())}))};document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("introView"),e=(document.getElementById("solverView"),document.getElementById("gridView")),n=e.getContext("2d"),o=document.getElementById("startButton"),i=document.getElementById("width"),s=document.getElementById("height"),l=()=>{let t=null;const e=new Promise(e=>t=e);return window.requestAnimationFrame(t),e};let c=null;const f=n=>{t.hidden=!0,e.hidden=!1,c=n,g(),b(!0),window.game=c},r=t=>{localStorage.setItem("game",JSON.stringify(t))},a=()=>{let t=!0,e=!0;for(const n of c.status.cols){if(n<0){t=!1,e=!1;break}65535!==n&&(e=!1)}for(const n of c.status.rows){if(n<0){t=!1,e=!1;break}65535!==n&&(e=!1)}return c.status.global=t?e?65535:0:-65535,c.status.global},g=()=>{for(let t=0;t<c.config.width;t++)c.status.cols[t]=y(t);for(let t=0;t<c.config.height;t++)c.status.rows[t]=p(t);a()};window.nono=window.nono||{},window.nono.statusAll=g;const d=t=>{let e=t;for(;e.next;)m(e),e.next.start.min<=e.end.min&&(e.next.start.min=e.end.min+1),e.next.start.max>e.end.max+1&&(e.next.start.max=e.end.max+1),e=e.next;m(e)},u=t=>{let e=t;for(;e.prev;)m(e),e.prev.end.max>=e.start.max&&(e.prev.end.max=e.start.max-1),e.prev.end.min<e.start.min-1&&(e.prev.end.min=e.start.min-1),e=e.prev;m(e)},h=(t,e,n)=>{if(-1===e)return;if(n.type===e){const e=[];for(const o of n.possibilities)t!==o.start-1&&t!==o.end+1&&e.push(o);return void(e.length<n.possibilities.length&&(n.possibilities=e))}const o=[];for(const e of n.possibilities)e.start<=t&&t<=e.end||o.push(e);o.length<n.possibilities.length&&(n.possibilities=o)},m=t=>{const e={max:-1/0,min:1/0},n={end:{max:-1/0,min:1/0},start:{max:-1/0,min:1/0}},o=[];for(const i of t.possibilities){const s=i.end+1-i.start;i.start<t.start.min||(i.start>t.start.max||i.end<t.end.min||i.end>t.end.max||s<t.length.min||s>t.length.max||(o.push(i),i.start<n.start.min&&(n.start.min=i.start),i.start>n.start.max&&(n.start.max=i.start),i.end<n.end.min&&(n.end.min=i.end),i.end>n.end.max&&(n.end.max=i.end),s<e.min&&(e.min=s),s>e.max&&(e.max=s)))}o.length<t.possibilities.length&&(t.possibilities=o),t.possibilities.length>0&&(t.start=n.start,t.end=n.end,t.length=e)},w=(t,e)=>{const n=[];let o=0;for(const e of t)o+=e;let i=e.length-o-t.length+1;const s={end:{max:i-1,min:-1},length:{max:i,min:0},next:null,possibilities:[],prev:null,start:{max:0,min:0},type:0};n.push(s);let l=s,c=s;for(const e of t){const t=l.start.min+l.length.min;c={end:{max:t+e-1+i,min:t+e-1},length:{max:e,min:e},next:null,possibilities:[],prev:l,start:{max:t+i,min:t},type:1},l.next=c,n.push(c);const o=c.end.min+1;l={end:{max:o+i,min:o},length:{max:1+i,min:1},next:null,possibilities:[],prev:c,start:{max:o+i,min:o},type:0},c.next=l,n.push(l)}l.length.min--,l.length.max--,l.end.max--,l.end.min=l.end.max;for(const t of n)for(let e=t.start.min;e<=t.start.max;e++)for(let n=t.length.min;n<=t.length.max;n++){const o=e+n-1;t.end.min<=o&&o<=t.end.max&&t.possibilities.push({end:o,start:e})}d(s),u(l);for(const t of n)for(let n=0;n<e.length;n++)h(n,e[n],t);return d(s),u(l),n},x=(t,e)=>{const n=w(t,e);let o=1,i=0,s=!0;for(const t of n){const n=t.possibilities.length;if(n<1)return-65535;if(0===t.type)continue;let l=1===n;if(l){const n=t.possibilities[0];for(let o=n.start;o<=n.end;o++)if(e[o]!==t.type){l=!1;break}}l?i|=o:s=!1,o*=2}return s?65535:i},y=t=>{if(c.cols[t].length<1)return 0;const e=[];for(const n of c.grid)e.push(n[t]);return x(c.cols[t],e)},p=t=>c.rows[t].length<1?0:x(c.rows[t],c.grid[t]),v=()=>{const t=i.value;localStorage.setItem("width",t);const e=s.value;localStorage.setItem("height",e),((t,e)=>{const n={cols:[],config:{height:e,scale:10,width:t,xOffset:10,yOffset:10},grid:[],rows:[],status:{cols:[],rows:[],global:0}};for(let e=0;e<t;e++)n.cols[e]=[],n.status.cols[e]=0;for(let o=0;o<e;o++){n.rows[o]=[],n.status.rows[o]=0,n.grid[o]=[];for(let e=0;e<t;e++)n.grid[o][e]=-1}r(n),f(n)})(+t,+e)},b=t=>{(t=>{let e=1,n=1;for(const t of c.cols)t.length>e&&(e=t.length);for(const t of c.rows)t.length>n&&(n=t.length);if(t){const t=(window.innerWidth-10)/(n+c.config.width),o=(window.innerHeight-10)/(e+c.config.height);c.config.scale=Math.floor(t<o?t:o),c.config.scale<5&&(c.config.scale=5)}c.config.xOffset=c.config.scale*n,c.config.yOffset=c.config.scale*e})(t),e.width=c.config.xOffset+c.config.width*c.config.scale,e.height=c.config.yOffset+c.config.height*c.config.scale,n.clearRect(0,0,e.width,e.height),O();for(let t=0;t<c.config.width;t++)M(t);for(let t=0;t<c.config.height;t++)I(t);S()};window.nono=window.nono||{},window.nono.redraw=b;const O=()=>{c.status.global?n.fillStyle=c.status.global<0?"#FCC":"#CFC":n.fillStyle="white",n.fillRect(0,0,c.config.xOffset,c.config.yOffset)},S=()=>{for(let t=0;t<c.config.height;t++)for(let e=0;e<c.config.width;e++)C(e,t,c.grid[t][e])},M=t=>{const e=c.config.scale/2;let o=c.config.yOffset-c.cols[t].length*c.config.scale+e;if(o<0)return!1;const i=c.config.xOffset+t*c.config.scale+e;n.fillStyle=1&t?"#FFF":"#CCC",n.fillRect(i-e,0,c.config.scale,c.config.yOffset),n.font=.8*c.config.scale+"px Monospace",n.textAlign="center",n.textBaseline="middle";const s=c.status.cols[t]>0?"gray":"red",l=c.status.cols[t]>0?c.status.cols[t]:-c.status.cols[t];let f=1;for(let e of c.cols[t])n.fillStyle=l&f?s:"black",n.fillText(""+e,i,o),f*=2,o+=c.config.scale;if(t>0&&t<c.config.width-1&&(t+1)%5<2&&c.status.global<1){const o=Math.max(1,Math.floor(c.config.scale/30));n.fillStyle="black",t%5==4?n.fillRect(i+e-o,0,o,c.config.yOffset):(n.fillStyle="black",n.fillRect(i-e,0,o,c.config.yOffset))}return!0},I=t=>{const e=c.config.scale/2,o=c.config.yOffset+t*c.config.scale+e;let i=c.config.xOffset-c.rows[t].length*c.config.scale+e;if(i<0)return!1;n.fillStyle=1&t?"#FFF":"#CCC",n.fillRect(0,o-e,c.config.xOffset,c.config.scale),n.font=.8*c.config.scale+"px Monospace",n.textAlign="center",n.textBaseline="middle";const s=c.status.rows[t]>0?"gray":"red",l=c.status.rows[t]>0?c.status.rows[t]:-c.status.rows[t];let f=1;for(let e of c.rows[t])n.fillStyle=l&f?s:"black",n.fillText(""+e,i,o),f*=2,i+=c.config.scale;if(t>0&&t<c.config.height-1&&(t+1)%5<2&&c.status.global<1){const i=Math.max(1,Math.floor(c.config.scale/30));n.fillStyle="black",t%5==4?n.fillRect(0,o+e-i,c.config.xOffset,i):(n.fillStyle="black",n.fillRect(0,o-e,c.config.xOffset,i))}return!0},C=(t,e,o)=>{if(t<0||e<0||t>=c.config.width||e>=c.config.height)throw new Error("Outside game-grid: "+JSON.stringify({x:t,y:e,type:o}));const i=c.config.xOffset+t*c.config.scale,s=c.config.yOffset+e*c.config.scale;n.fillStyle="#808080",n.fillRect(i,s,c.config.scale,c.config.scale),n.fillStyle="#C0C0C0",n.fillRect(i,s,c.config.scale-1,c.config.scale-1),n.fillStyle="#404040",n.fillRect(i+1,s+1,c.config.scale-1,c.config.scale-1),n.fillStyle=o<0?"#808080":o?"black":"white",c.status.global>0?n.fillRect(i,s,c.config.scale,c.config.scale):n.fillRect(i+1,s+1,c.config.scale-2,c.config.scale-2)},E=t=>{const e=c.cols[t].join(" "),n=prompt("Config col "+(1+t),e);if(null===n)return!1;if(e===n)return!0;if(""===n)return c.cols[t].length=0,r(c),!0;const o=n.split(/[ ,]+/g),i=[];let s=0;for(const t of o){const e=Math.floor(+t);e>0&&i.push(e),s+=e}return i.length<1?(console.error("Invalid col: "+n),void alert("Invalid col: "+n)):s+i.length>c.config.height+1?(console.error("Invalid col-size: "+n),console.error(i),void alert("Invalid col-size: "+n)):(c.cols[t]=i,r(c),c.status.cols[t]=y(t),M(t)||b(!0),!0)},R=t=>{if(c.cols[t].length<1)return!1;const e=[];for(const n of c.grid)e.push(n[t]);let n=!1;const o=w(c.cols[t],e),i=c.status.global;for(const e of o)for(let o=e.start.max;o<=e.end.min;o++)if(c.grid[o][t]!==e.type){c.grid[o][t]=e.type,n=!0,C(t,o,e.type);const i=p(o);c.status.rows[o]!==i&&(c.status.rows[o]=i,I(o))}if(n){const e=y(t);c.status.cols[t]!==e&&(c.status.cols[t]=e,M(t)),i!==a()&&(c.status.global>0?b(!1):O()),r(c)}return n},k=t=>{const e=c.rows[t].join(" "),n=prompt("Config row "+(1+t),e);if(null===n)return!1;if(e===n)return!0;if(""===n)return c.rows[t].length=0,r(c),!0;const o=n.split(/[ ,]+/g),i=[];let s=0;for(const t of o){const e=Math.floor(+t);e>0&&i.push(e),s+=e}return i.length<1?(console.error("Invalid row: "+n),void alert("Invalid row: "+n)):s+i.length>c.config.width+1?(console.error("Invalid row-size: "+n),console.error({newList:i,width:c.config.width,sum:s,length:i.length,max:s+i.length-1}),void alert("Invalid row-size: "+n)):(c.rows[t]=i,r(c),c.status.rows[t]=p(t),I(t)||b(!0),!0)},K=t=>{if(c.rows[t].length<1)return!1;let e=!1;const n=w(c.rows[t],c.grid[t]),o=c.status.global;for(const o of n)for(let n=o.start.max;n<=o.end.min;n++)if(c.grid[t][n]!==o.type){c.grid[t][n]=o.type,e=!0,C(n,t,o.type);const i=y(n);c.status.cols[n]!==i&&(c.status.cols[n]=i,M(n))}if(e){const e=p(t);c.status.rows[t]!==e&&(c.status.rows[t]=e,I(t)),o!==a()&&(c.status.global>0?b(!1):O()),r(c)}return e},L=t=>{const e=Math.floor((t.clientX-c.config.xOffset)/c.config.scale),n=Math.floor((t.clientY-c.config.yOffset)/c.config.scale);return e<0?n<0?(t=>{if(t.ctrlKey&&confirm("Delete game?"))localStorage.removeItem("game"),location.reload();else if(t.metaKey){for(let e=0;e<c.config.width;e++)if(R(e)&&!t.shiftKey)return;for(let e=0;e<c.config.height;e++)if(K(e)&&!t.shiftKey)return}else t.shiftKey&&confirm("Reset game?")?(r((t=>{t.grid=[],t.status={cols:[],rows:[],global:0};for(let e=0;e<t.config.width;e++)t.status.cols[e]=0;for(let e=0;e<t.config.height;e++){t.status.rows[e]=0,t.grid[e]=[];for(let n=0;n<t.config.width;n++)t.grid[e][n]=-1}return t})(c)),location.reload()):(f(c),__awaiter(void 0,void 0,void 0,(function*(){for(let t=0;t<c.config.width;t++){if(!E(t))return;yield l()}for(let t=0;t<c.config.height;t++){if(!k(t))return;yield l()}})))})(t):((t,e)=>{e||c.rows[t].length<=0?k(t)&&__awaiter(void 0,void 0,void 0,(function*(){for(yield l();++t<c.config.height&&c.rows[t].length<=0&&k(t);)yield l()})):K(t)})(n,t.shiftKey||t.ctrlKey):n<0?((t,e)=>{e||c.cols[t].length<=0?E(t)&&__awaiter(void 0,void 0,void 0,(function*(){for(yield l();++t<c.config.width&&c.cols[t].length<=0&&E(t);)yield l()})):R(t)})(e,t.shiftKey||t.ctrlKey):null!==z&&z===e&&null!==A&&A===n?(z=null,void(A=null)):((t,e,n)=>{const o=(1+c.grid[e][t]+(n?1:2))%3-1;c.grid[e][t]=o,r(c),C(t,e,o);const i=c.status.global,s=y(t);c.status.cols[t]!==s&&(c.status.cols[t]=s,M(t));const l=p(e);c.status.rows[e]!==l&&(c.status.rows[e]=l,I(e)),i!==a()&&(c.status.global>0?b(!1):O())})(e,n,t.button>0||t.shiftKey)};let B=null,F=null,_=null,z=null,A=null;const X=t=>{const n=Math.floor((t.clientX-c.config.xOffset)/c.config.scale),o=Math.floor((t.clientY-c.config.yOffset)/c.config.scale);if(n<0||o<0||n>=c.config.width||o>=c.config.height)return;const i=t.button>0||t.shiftKey?1:2;B=(1+c.grid[o][n]+i)%3-1,F=n,_=o,z=n,A=o,e.addEventListener("mousemove",N,{once:!1,passive:!0}),e.addEventListener("mouseup",J,{once:!0,passive:!0})},Y=t=>{B=null,F=null,_=null,t?(g(),b(!1)):S(),e.removeEventListener("mousemove",N),e.removeEventListener("mouseup",J)},J=t=>{if(null==F||null==_||null===B)return Y(!1);const e=Math.floor((t.clientX-c.config.xOffset)/c.config.scale),n=Math.floor((t.clientY-c.config.yOffset)/c.config.scale),o=Math.max(0,Math.min(c.config.width-1,e)),i=Math.max(0,Math.min(c.config.height-1,n));if(e!==o||n!==i)return Y(!1);const s=o<F?o:F,l=o>F?o:F,f=i<_?i:_,r=i>_?i:_;if(s===l&&f===r)return z=null,A=null,Y(!1);N(t);for(let t=s;t<=l;t++)for(let e=f;e<=r;e++)c.grid[e][t]=B;return Y(!0)},N=t=>{if(null==F||null==_||null===B)return Y(!1);const e=Math.floor((t.clientX-c.config.xOffset)/c.config.scale),n=Math.floor((t.clientY-c.config.yOffset)/c.config.scale),o=e<0||e>=c.config.width-1?F:e,i=n<0||n>=c.config.height-1?_:n;if(o===z&&i===A)return;const s=o<F?o:F,l=o<z?o:z,f=o>F?o:F,r=o>z?o:z,a=f>r?f:r,g=i<_?i:_,d=i<A?i:A,u=g<d?g:d,h=i>_?i:_,m=i>A?i:A,w=h>m?h:m;for(let t=s<l?s:l;t<=a;t++)for(let e=u;e<=w;e++)C(t,e,s<=t&&t<=f&&g<=e&&e<=h?B:c.grid[e][t]);z=o,A=i};(()=>{const t=localStorage.getItem("width"),e=localStorage.getItem("height"),n=localStorage.getItem("game");if(t&&(i.value=t),e&&(s.value=e),n){const t=JSON.parse(n);f(t)}})(),o.addEventListener("click",v,{once:!1,passive:!0}),e.addEventListener("click",L,{once:!1,passive:!0}),e.addEventListener("mousedown",X,{once:!1,passive:!0})},{once:!0,passive:!0});
//# sourceMappingURL=es6.js.map
