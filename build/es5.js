"use strict";document.addEventListener("DOMContentLoaded",function(){function a(t){localStorage.setItem("game",JSON.stringify(t))}function o(){for(var t=!0,e=!0,n=0,i=g.status.cols;n<i.length;n++){var o=i[n];if(o<0){e=t=!1;break}65535!==o&&(e=!1)}for(var s=0,l=g.status.rows;s<l.length;s++){var r=l[s];if(r<0){e=t=!1;break}65535!==r&&(e=!1)}return g.status.global=t?e?65535:0:-65535,g.status.global}var e=document.getElementById("introView"),i=(document.getElementById("solverView"),document.getElementById("gridView")),c=i.getContext("2d"),t=document.getElementById("startButton"),n=document.getElementById("width"),s=document.getElementById("height"),g=null,l=function(t){e.hidden=!0,i.hidden=!1,g=t,r(),v(!0),window.game=g},r=function(){for(var t=0;t<g.config.width;t++)g.status.cols[t]=m(t);for(var e=0;e<g.config.height;e++)g.status.rows[e]=u(e);o()};window.nano=window.nano||{},window.nano.statusAll=r;function K(t){for(var e=t;e.next;)h(e),e.next.start.min<=e.end.min&&(e.next.start.min=e.end.min+1),e.next.start.max>e.end.max+1&&(e.next.start.max=e.end.max+1),e=e.next;h(e)}function L(t){for(var e=t;e.prev;)h(e),e.prev.end.max>=e.start.max&&(e.prev.end.max=e.start.max-1),e.prev.end.min<e.start.min-1&&(e.prev.end.min=e.start.min-1),e=e.prev;h(e)}function f(t,e){for(var n=[],i=0,o=0,s=t;o<s.length;o++)i+=s[o];var l=e.length-i-t.length+1,r={end:{max:l-1,min:-1},length:{max:l,min:0},next:null,possibilities:[],prev:null,start:{max:0,min:0},type:0};n.push(r);for(var a=r,f=r,c=0,g=t;c<g.length;c++){var d=g[c],h=a.start.min+a.length.min,f={end:{max:h+d-1+l,min:h+d-1},length:{max:d,min:d},next:null,possibilities:[],prev:a,start:{max:h+l,min:h},type:1};a.next=f,n.push(f);h=f.end.min+1,a={end:{max:h+l,min:h},length:{max:1+l,min:1},next:null,possibilities:[],prev:f,start:{max:h+l,min:h},type:0};f.next=a,n.push(a)}a.length.min--,a.length.max--,a.end.max--,a.end.min=a.end.max;for(var m=0,u=n;m<u.length;m++)for(var v=(b=u[m]).start.min;v<=b.start.max;v++)for(var w=b.length.min;w<=b.length.max;w++){var x=v+w-1;b.end.min<=x&&x<=b.end.max&&b.possibilities.push({end:x,start:v})}K(r),L(a);for(var p=0,y=n;p<y.length;p++)for(var b=y[p],O=0;O<e.length;O++)!function(t,e,n){if(-1!==e)if(n.type!==e){for(var i=[],o=0,s=n.possibilities;o<s.length;o++)(l=s[o]).start<=t&&t<=l.end||i.push(l);i.length<n.possibilities.length&&(n.possibilities=i)}else{for(var l,r=[],a=0,f=n.possibilities;a<f.length;a++)t!==(l=f[a]).start-1&&t!==l.end+1&&r.push(l);r.length<n.possibilities.length&&(n.possibilities=r)}}(O,e[O],b);K(r),L(a);for(var I=1,S=0,C=!0,E=0,B=n;E<B.length;E++){var R=(b=B[E]).possibilities.length;if(R<1)return-65535;if(0!==b.type){var k=1===R;if(k)for(var F=b.possibilities[0],M=F.start;M<=F.end;M++)if(e[M]!==b.type){k=!1;break}k?S|=I:C=!1,I*=2}}return C?65535:S}function d(){var t=n.value;localStorage.setItem("width",t);var e=s.value;localStorage.setItem("height",e),function(t,e){for(var n={cols:[],config:{height:e,scale:10,width:t,xOffset:10,yOffset:10},grid:[],rows:[],status:{cols:[],rows:[],global:0}},i=0;i<t;i++)n.cols[i]=[],n.status.cols[i]=0;for(var o=0;o<e;o++){n.rows[o]=[],n.status.rows[o]=0,n.grid[o]=[];for(i=0;i<t;i++)n.grid[o][i]=-1}a(n),l(n)}(+t,+e)}var h=function(t){for(var e={max:-1/0,min:1/0},n={end:{max:-1/0,min:1/0},start:{max:-1/0,min:1/0}},i=[],o=0,s=t.possibilities;o<s.length;o++){var l=s[o],r=l.end+1-l.start;l.start<t.start.min||l.start>t.start.max||l.end<t.end.min||l.end>t.end.max||r<t.length.min||r>t.length.max||(i.push(l),l.start<n.start.min&&(n.start.min=l.start),l.start>n.start.max&&(n.start.max=l.start),l.end<n.end.min&&(n.end.min=l.end),l.end>n.end.max&&(n.end.max=l.end),r<e.min&&(e.min=r),r>e.max&&(e.max=r))}i.length<t.possibilities.length&&(t.possibilities=i),0<t.possibilities.length&&(t.start=n.start,t.end=n.end,t.length=e)},m=function(t){if(g.cols[t].length<1)return 0;for(var e=[],n=0,i=g.grid;n<i.length;n++){var o=i[n];e.push(o[t])}return f(g.cols[t],e)},u=function(t){return g.rows[t].length<1?0:f(g.rows[t],g.grid[t])},v=function(t){!function(t){for(var e=1,n=1,i=0,o=g.cols;i<o.length;i++){var s=o[i];s.length>e&&(e=s.length)}for(var l,r=0,a=g.rows;r<a.length;r++){var f=a[r];f.length>n&&(n=f.length)}t&&(l=(window.innerWidth-10)/(n+g.config.width),t=(window.innerHeight-10)/(e+g.config.height),g.config.scale=Math.floor(l<t?l:t),g.config.scale<5&&(g.config.scale=5)),g.config.xOffset=g.config.scale*n,g.config.yOffset=g.config.scale*e}(t),i.width=g.config.xOffset+g.config.width*g.config.scale,i.height=g.config.yOffset+g.config.height*g.config.scale,c.clearRect(0,0,i.width,i.height),y();for(var e=0;e<g.config.width;e++)O(e);for(var n=0;n<g.config.height;n++)I(n);b()};window.nano=window.nano||{},window.nano.redraw=v;var w,x,p,y=function(){g.status.global?c.fillStyle=g.status.global<0?"#FCC":"#CFC":c.fillStyle="white",c.fillRect(0,0,g.config.xOffset,g.config.yOffset)},b=function(){for(var t=0;t<g.config.height;t++)for(var e=0;e<g.config.width;e++)S(e,t,g.grid[t][e])},O=function(t){var e=g.config.scale/2,n=g.config.yOffset-g.cols[t].length*g.config.scale+e,i=g.config.xOffset+t*g.config.scale+e;c.fillStyle=1&t?"#FFF":"#CCC",c.fillRect(i-e,0,g.config.scale,g.config.yOffset),c.font=.8*g.config.scale+"px Monospace",c.textAlign="center",c.textBaseline="middle";for(var o=0<g.status.cols[t]?"gray":"red",s=0<g.status.cols[t]?g.status.cols[t]:-g.status.cols[t],l=1,r=0,a=g.cols[t];r<a.length;r++){var f=a[r];c.fillStyle=s&l?o:"black",c.fillText(""+f,i,n),l*=2,n+=g.config.scale}},I=function(t){var e=g.config.scale/2,n=g.config.yOffset+t*g.config.scale+e,i=g.config.xOffset-g.rows[t].length*g.config.scale+e;c.fillStyle=1&t?"#FFF":"#CCC",c.fillRect(0,n-e,g.config.xOffset,g.config.scale),c.font=.8*g.config.scale+"px Monospace",c.textAlign="center",c.textBaseline="middle";for(var o=0<g.status.rows[t]?"gray":"red",s=0<g.status.rows[t]?g.status.rows[t]:-g.status.rows[t],l=1,r=0,a=g.rows[t];r<a.length;r++){var f=a[r];c.fillStyle=s&l?o:"black",c.fillText(""+f,i,n),l*=2,i+=g.config.scale}},S=function(t,e,n){if(t<0||e<0||t>=g.config.width||e>=g.config.height)throw new Error("Outside game-grid: "+JSON.stringify({x:t,y:e,type:n}));t=g.config.xOffset+t*g.config.scale,e=g.config.yOffset+e*g.config.scale;c.fillStyle="#808080",c.fillRect(t,e,g.config.scale,g.config.scale),c.fillStyle="#C0C0C0",c.fillRect(t,e,g.config.scale-1,g.config.scale-1),c.fillStyle="#404040",c.fillRect(t+1,e+1,g.config.scale-1,g.config.scale-1),c.fillStyle=n<0?"#808080":n?"black":"white",c.fillRect(t+1,e+1,g.config.scale-2,g.config.scale-2)},C=function(t){var e,n=Math.floor((t.clientX-g.config.xOffset)/g.config.scale),i=Math.floor((t.clientY-g.config.yOffset)/g.config.scale);return n<0?i<0?void((e=t).ctrlKey&&confirm("Delete game?")?(localStorage.removeItem("game"),location.reload()):e.shiftKey&&confirm("Reset game?")?(a(function(t){t.grid=[],t.status={cols:[],rows:[],global:0};for(var e=0;e<t.config.width;e++)t.status.cols[e]=0;for(var n=0;n<t.config.height;n++){t.status.rows[n]=0,t.grid[n]=[];for(e=0;e<t.config.width;e++)t.grid[n][e]=-1}return t}(g)),location.reload()):l(g)):function(t,e){if(!(0<g.rows[t].length)||e){var n=g.rows[t].join(" "),e=prompt("Config row "+(1+t),n);if(null!==e&&n!==e){if(""===e)return g.rows[t].length=0,void a(g);for(var i=[],o=0,s=0,l=e.split(/[ ,]+/g);s<l.length;s++){var r=l[s],r=Math.floor(+r);0<r&&i.push(r),o+=r}return i.length<1?(console.error("Invalid row: "+e),void alert("Invalid row: "+e)):o+i.length>g.config.width+1?(console.error("Invalid row-size: "+e),console.error({newList:i,width:g.config.width,sum:o,length:i.length,max:o+i.length-1}),void alert("Invalid row-size: "+e)):(g.rows[t]=i,a(g),g.status.rows[t]=u(t),void I(t))}}}(i,t.shiftKey||t.ctrlKey):i<0?function(t,e){if(!(0<g.cols[t].length)||e){var n=g.cols[t].join(" "),e=prompt("Config col "+(1+t),n);if(null!==e&&n!==e){if(""===e)return g.cols[t].length=0,void a(g);for(var i=[],o=0,s=0,l=e.split(/[ ,]+/g);s<l.length;s++){var r=l[s],r=Math.floor(+r);0<r&&i.push(r),o+=r}return i.length<1?(console.error("Invalid col: "+e),void alert("Invalid col: "+e)):o+i.length>g.config.height+1?(console.error("Invalid col-size: "+e),console.error(i),void alert("Invalid col-size: "+e)):(g.cols[t]=i,a(g),g.status.cols[t]=m(t),void O(t))}}}(n,t.shiftKey||t.ctrlKey):function(t,e,n){var i=(1+g.grid[e][t]+(n?1:2))%3-1;g.grid[e][t]=i,a(g),S(t,e,i);n=g.status.global,i=m(t);g.status.cols[t]!==i&&(g.status.cols[t]=i,O(t));t=u(e);g.status.rows[e]!==t&&(g.status.rows[e]=t,I(e)),n!==o()&&y()}(n,i,0<t.button||t.shiftKey)};w=localStorage.getItem("width"),x=localStorage.getItem("height"),p=localStorage.getItem("game"),w&&(n.value=w),x&&(s.value=x),p&&(p=JSON.parse(p),l(p)),t.addEventListener("click",d,{once:!1,passive:!0}),i.addEventListener("click",C,{once:!1,passive:!0})},{once:!0,passive:!0});
//# sourceMappingURL=es5.js.map
