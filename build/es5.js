"use strict";var __awaiter=function(t,l,s,a){return new(s=s||Promise)(function(n,e){function i(t){try{r(a.next(t))}catch(t){e(t)}}function o(t){try{r(a.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?n(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(i,o)}r((a=a.apply(t,l||[])).next())})},__generator=function(n,i){var o,r,l,s={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(l=2&e[0]?r.return:e[0]?r.throw||((l=r.return)&&l.call(r),0):r.next)&&!(l=l.call(r,e[1])).done)return l;switch(r=0,(e=l?[2&e[0],l.value]:e)[0]){case 0:case 1:l=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,r=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(l=0<(l=s.trys).length&&l[l.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!l||e[1]>l[0]&&e[1]<l[3])){s.label=e[1];break}if(6===e[0]&&s.label<l[1]){s.label=l[1],l=e;break}if(l&&s.label<l[2]){s.label=l[2],s.ops.push(e);break}l[2]&&s.ops.pop(),s.trys.pop();continue}e=i.call(n,s)}catch(t){e=[6,t],r=0}finally{o=l=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},_this=void 0;document.addEventListener("DOMContentLoaded",function(){function r(){var e=null,t=new Promise(function(t){return e=t});return window.requestAnimationFrame(e),t}function h(t){localStorage.setItem("game",JSON.stringify(t))}function d(){for(var t=!0,e=!0,n=0,i=v.status.cols;n<i.length;n++){var o=i[n];if(o<0){e=t=!1;break}65535!==o&&(e=!1)}for(var r=0,l=v.status.rows;r<l.length;r++){var s=l[r];if(s<0){e=t=!1;break}65535!==s&&(e=!1)}return v.status.global=t?e?65535:0:-65535,v.status.global}var e=document.getElementById("introView"),i=(document.getElementById("solverView"),document.getElementById("gridView")),g=i.getContext("2d"),t=document.getElementById("startButton"),n=document.getElementById("width"),o=document.getElementById("height"),v=null,l=function(t){e.hidden=!0,i.hidden=!1,v=t,s(),x(!0),window.game=v},s=function(){for(var t=0;t<v.config.width;t++)v.status.cols[t]=w(t);for(var e=0;e<v.config.height;e++)v.status.rows[e]=p(e);d()};window.nono=window.nono||{},window.nono.statusAll=s;function S(t){for(var e=t;e.next;)c(e),e.next.start.min<=e.end.min&&(e.next.start.min=e.end.min+1),e.next.start.max>e.end.max+1&&(e.next.start.max=e.end.max+1),e=e.next;c(e)}function M(t){for(var e=t;e.prev;)c(e),e.prev.end.max>=e.start.max&&(e.prev.end.max=e.start.max-1),e.prev.end.min<e.start.min-1&&(e.prev.end.min=e.start.min-1),e=e.prev;c(e)}function m(t,e){for(var n=[],i=0,o=0,r=t;o<r.length;o++)i+=r[o];var l=e.length-i-t.length+1,s={end:{max:l-1,min:-1},length:{max:l,min:0},next:null,possibilities:[],prev:null,start:{max:0,min:0},type:0};n.push(s);for(var a=s,f=s,c=0,g=t;c<g.length;c++){var u=g[c],h=a.start.min+a.length.min,f={end:{max:h+u-1+l,min:h+u-1},length:{max:u,min:u},next:null,possibilities:[],prev:a,start:{max:h+l,min:h},type:1};a.next=f,n.push(f);h=f.end.min+1,a={end:{max:h+l,min:h},length:{max:1+l,min:1},next:null,possibilities:[],prev:f,start:{max:h+l,min:h},type:0};f.next=a,n.push(a)}a.length.min--,a.length.max--,a.end.max--,a.end.min=a.end.max;for(var d=0,v=n;d<v.length;d++)for(var m=(b=v[d]).start.min;m<=b.start.max;m++)for(var w=b.length.min;w<=b.length.max;w++){var p=m+w-1;b.end.min<=p&&p<=b.end.max&&b.possibilities.push({end:p,start:m})}S(s),M(a);for(var x=0,y=n;x<y.length;x++)for(var b=y[x],O=0;O<e.length;O++)!function(t,e,n){if(-1!==e)if(n.type!==e){for(var i=[],o=0,r=n.possibilities;o<r.length;o++)(l=r[o]).start<=t&&t<=l.end||i.push(l);i.length<n.possibilities.length&&(n.possibilities=i)}else{for(var l,s=[],a=0,f=n.possibilities;a<f.length;a++)t!==(l=f[a]).start-1&&t!==l.end+1&&s.push(l);s.length<n.possibilities.length&&(n.possibilities=s)}}(O,e[O],b);return S(s),M(a),n}function a(t,e){for(var n=1,i=0,o=!0,r=0,l=m(t,e);r<l.length;r++){var s=l[r],a=s.possibilities.length;if(a<1)return-65535;if(0!==s.type){var f=1===a;if(f)for(var c=s.possibilities[0],g=c.start;g<=c.end;g++)if(e[g]!==s.type){f=!1;break}f?i|=n:o=!1,n*=2}}return o?65535:i}function f(){var t=n.value;localStorage.setItem("width",t);var e=o.value;localStorage.setItem("height",e),function(t,e){for(var n={cols:[],config:{height:e,scale:10,width:t,xOffset:10,yOffset:10},grid:[],rows:[],status:{cols:[],rows:[],global:0}},i=0;i<t;i++)n.cols[i]=[],n.status.cols[i]=0;for(var o=0;o<e;o++){n.rows[o]=[],n.status.rows[o]=0,n.grid[o]=[];for(i=0;i<t;i++)n.grid[o][i]=-1}h(n),l(n)}(+t,+e)}var c=function(t){for(var e={max:-1/0,min:1/0},n={end:{max:-1/0,min:1/0},start:{max:-1/0,min:1/0}},i=[],o=0,r=t.possibilities;o<r.length;o++){var l=r[o],s=l.end+1-l.start;l.start<t.start.min||l.start>t.start.max||l.end<t.end.min||l.end>t.end.max||s<t.length.min||s>t.length.max||(i.push(l),l.start<n.start.min&&(n.start.min=l.start),l.start>n.start.max&&(n.start.max=l.start),l.end<n.end.min&&(n.end.min=l.end),l.end>n.end.max&&(n.end.max=l.end),s<e.min&&(e.min=s),s>e.max&&(e.max=s))}i.length<t.possibilities.length&&(t.possibilities=i),0<t.possibilities.length&&(t.start=n.start,t.end=n.end,t.length=e)},w=function(t){if(v.cols[t].length<1)return 0;for(var e=[],n=0,i=v.grid;n<i.length;n++){var o=i[n];e.push(o[t])}return a(v.cols[t],e)},p=function(t){return v.rows[t].length<1?0:a(v.rows[t],v.grid[t])},x=function(t){!function(t){for(var e=1,n=1,i=0,o=v.cols;i<o.length;i++){var r=o[i];r.length>e&&(e=r.length)}for(var l,s=0,a=v.rows;s<a.length;s++){var f=a[s];f.length>n&&(n=f.length)}t&&(l=(window.innerWidth-10)/(n+v.config.width),t=(window.innerHeight-10)/(e+v.config.height),v.config.scale=Math.floor(l<t?l:t),v.config.scale<5&&(v.config.scale=5)),v.config.xOffset=v.config.scale*n,v.config.yOffset=v.config.scale*e}(t),i.width=v.config.xOffset+v.config.width*v.config.scale,i.height=v.config.yOffset+v.config.height*v.config.scale,g.clearRect(0,0,i.width,i.height),E();for(var e=0;e<v.config.width;e++)K(e);for(var n=0;n<v.config.height;n++)L(n);R()};window.nono=window.nono||{},window.nono.redraw=x;function u(t){var e=v.cols[t].join(" "),n=prompt("Config col "+(1+t),e);if(null!==n){if(e===n)return 1;if(""===n)return v.cols[t].length=0,h(v),1;for(var i=[],o=0,r=0,l=n.split(/[ ,]+/g);r<l.length;r++){var s=l[r],s=Math.floor(+s);0<s&&i.push(s),o+=s}return i.length<1?(console.error("Invalid col: "+n),void alert("Invalid col: "+n)):o+i.length>v.config.height+1?(console.error("Invalid col-size: "+n),console.error(i),void alert("Invalid col-size: "+n)):(v.cols[t]=i,h(v),v.status.cols[t]=w(t),K(t)||x(!0),!0)}}function y(t){if(!(v.cols[t].length<1)){for(var e=[],n=0,i=v.grid;n<i.length;n++){var o=i[n];e.push(o[t])}for(var r=!1,l=m(v.cols[t],e),s=v.status.global,a=0,f=l;a<f.length;a++)for(var c,g=f[a],u=g.start.max;u<=g.end.min;u++)v.grid[u][t]!==g.type&&(v.grid[u][t]=g.type,r=!0,B(t,u,g.type),c=p(u),v.status.rows[u]!==c&&(v.status.rows[u]=c,L(u)));return r&&(l=w(t),v.status.cols[t]!==l&&(v.status.cols[t]=l,K(t)),s!==d()&&(0<v.status.global?x(!1):E()),h(v)),r}}function b(t){var e=v.rows[t].join(" "),n=prompt("Config row "+(1+t),e);if(null!==n){if(e===n)return 1;if(""===n)return v.rows[t].length=0,h(v),1;for(var i=[],o=0,r=0,l=n.split(/[ ,]+/g);r<l.length;r++){var s=l[r],s=Math.floor(+s);0<s&&i.push(s),o+=s}return i.length<1?(console.error("Invalid row: "+n),void alert("Invalid row: "+n)):o+i.length>v.config.width+1?(console.error("Invalid row-size: "+n),console.error({newList:i,width:v.config.width,sum:o,length:i.length,max:o+i.length-1}),void alert("Invalid row-size: "+n)):(v.rows[t]=i,h(v),v.status.rows[t]=p(t),L(t)||x(!0),!0)}}function O(t){if(!(v.rows[t].length<1)){for(var e=!1,n=m(v.rows[t],v.grid[t]),i=v.status.global,o=0,r=n;o<r.length;o++)for(var l,s=r[o],a=s.start.max;a<=s.end.min;a++)v.grid[t][a]!==s.type&&(v.grid[t][a]=s.type,e=!0,B(a,t,s.type),l=w(a),v.status.cols[a]!==l&&(v.status.cols[a]=l,K(a)));return e&&(n=p(t),v.status.rows[t]!==n&&(v.status.rows[t]=n,L(t)),i!==d()&&(0<v.status.global?x(!1):E()),h(v)),e}}function I(t){X=A=z=null,t?(s(),x(!1)):R(),i.removeEventListener("mousemove",V),i.removeEventListener("mouseup",T)}var _,C,k,E=function(){v.status.global?g.fillStyle=v.status.global<0?"#FCC":"#CFC":g.fillStyle="white",g.fillRect(0,0,v.config.xOffset,v.config.yOffset)},R=function(){for(var t=0;t<v.config.height;t++)for(var e=0;e<v.config.width;e++)B(e,t,v.grid[t][e])},K=function(t){var e=v.config.scale/2,n=v.config.yOffset-v.cols[t].length*v.config.scale+e;if(n<0)return!1;var i=v.config.xOffset+t*v.config.scale+e;g.fillStyle=1&t?"#FFF":"#CCC",g.fillRect(i-e,0,v.config.scale,v.config.yOffset),g.font=.8*v.config.scale+"px Monospace",g.textAlign="center",g.textBaseline="middle";for(var o,r=0<v.status.cols[t]?"gray":"red",l=0<v.status.cols[t]?v.status.cols[t]:-v.status.cols[t],s=1,a=0,f=v.cols[t];a<f.length;a++){var c=f[a];g.fillStyle=l&s?r:"black",g.fillText(""+c,i,n),s*=2,n+=v.config.scale}return 0<t&&t<v.config.width-1&&(t+1)%5<2&&v.status.global<1&&(o=Math.max(1,Math.floor(v.config.scale/30)),g.fillStyle="black",t%5==4?g.fillRect(i+e-o,0,o,v.config.yOffset):(g.fillStyle="black",g.fillRect(i-e,0,o,v.config.yOffset))),!0},L=function(t){var e=v.config.scale/2,n=v.config.yOffset+t*v.config.scale+e,i=v.config.xOffset-v.rows[t].length*v.config.scale+e;if(i<0)return!1;g.fillStyle=1&t?"#FFF":"#CCC",g.fillRect(0,n-e,v.config.xOffset,v.config.scale),g.font=.8*v.config.scale+"px Monospace",g.textAlign="center",g.textBaseline="middle";for(var o,r=0<v.status.rows[t]?"gray":"red",l=0<v.status.rows[t]?v.status.rows[t]:-v.status.rows[t],s=1,a=0,f=v.rows[t];a<f.length;a++){var c=f[a];g.fillStyle=l&s?r:"black",g.fillText(""+c,i,n),s*=2,i+=v.config.scale}return 0<t&&t<v.config.height-1&&(t+1)%5<2&&v.status.global<1&&(o=Math.max(1,Math.floor(v.config.scale/30)),g.fillStyle="black",t%5==4?g.fillRect(0,n+e-o,v.config.xOffset,o):(g.fillStyle="black",g.fillRect(0,n-e,v.config.xOffset,o))),!0},B=function(t,e,n){if(t<0||e<0||t>=v.config.width||e>=v.config.height)throw new Error("Outside game-grid: "+JSON.stringify({x:t,y:e,type:n}));t=v.config.xOffset+t*v.config.scale,e=v.config.yOffset+e*v.config.scale;g.fillStyle="#808080",g.fillRect(t,e,v.config.scale,v.config.scale),g.fillStyle="#C0C0C0",g.fillRect(t,e,v.config.scale-1,v.config.scale-1),g.fillStyle="#404040",g.fillRect(t+1,e+1,v.config.scale-1,v.config.scale-1),g.fillStyle=n<0?"#808080":n?"black":"white",0<v.status.global?g.fillRect(t,e,v.config.scale,v.config.scale):g.fillRect(t+1,e+1,v.config.scale-2,v.config.scale-2)},F=function(t){var e,n,i=Math.floor((t.clientX-v.config.xOffset)/v.config.scale),o=Math.floor((t.clientY-v.config.yOffset)/v.config.scale);return i<0?o<0?function(t){if(t.ctrlKey&&confirm("Delete game?"))localStorage.removeItem("game"),location.reload();else if(t.metaKey){for(var e=0;e<v.config.width;e++)if(y(e)&&!t.shiftKey)return;for(var n=0;n<v.config.height;n++)if(O(n)&&!t.shiftKey)return}else t.shiftKey&&confirm("Reset game?")?(h(function(t){t.grid=[],t.status={cols:[],rows:[],global:0};for(var e=0;e<t.config.width;e++)t.status.cols[e]=0;for(var n=0;n<t.config.height;n++){t.status.rows[n]=0,t.grid[n]=[];for(e=0;e<t.config.width;e++)t.grid[n][e]=-1}return t}(v)),location.reload()):(l(v),__awaiter(_this,void 0,void 0,function(){var e,n;return __generator(this,function(t){switch(t.label){case 0:e=0,t.label=1;case 1:return e<v.config.width?u(e)?[4,r()]:[2]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:n=0,t.label=5;case 5:return n<v.config.height?b(n)?[4,r()]:[2]:[3,8];case 6:t.sent(),t.label=7;case 7:return n++,[3,5];case 8:return[2]}})}))}(t):(e=o,void(t.shiftKey||t.ctrlKey||v.rows[e].length<=0?b(e)&&__awaiter(_this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,r()];case 1:t.sent(),t.label=2;case 2:return++e<v.config.height&&v.rows[e].length<=0&&b(e)?[4,r()]:[3,4];case 3:return t.sent(),[3,2];case 4:return[2]}})}):O(e))):o<0?(n=i,void(t.shiftKey||t.ctrlKey||v.cols[n].length<=0?u(n)&&__awaiter(_this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,r()];case 1:t.sent(),t.label=2;case 2:return++n<v.config.width&&v.cols[n].length<=0&&u(n)?[4,r()]:[3,4];case 3:return t.sent(),[3,2];case 4:return[2]}})}):y(n))):null===Y||Y!==i||null===J||J!==o?function(t,e,n){var i=(1+v.grid[e][t]+(n?1:2))%3-1;v.grid[e][t]=i,h(v),B(t,e,i);n=v.status.global,i=w(t);v.status.cols[t]!==i&&(v.status.cols[t]=i,K(t));t=p(e);v.status.rows[e]!==t&&(v.status.rows[e]=t,L(e)),n!==d()&&(0<v.status.global?x(!1):E())}(i,o,0<t.button||t.shiftKey):void(J=Y=null)},z=null,A=null,X=null,Y=null,J=null,N=function(t){var e=Math.floor((t.clientX-v.config.xOffset)/v.config.scale),n=Math.floor((t.clientY-v.config.yOffset)/v.config.scale);e<0||n<0||e>=v.config.width||n>=v.config.height||(t=0<t.button||t.shiftKey?1:2,z=(1+v.grid[n][e]+t)%3-1,Y=A=e,J=X=n,i.addEventListener("mousemove",V,{once:!1,passive:!0}),i.addEventListener("mouseup",T,{once:!0,passive:!0}))},T=function(t){if(null==A||null==X||null===z)return I(!1);var e=Math.floor((t.clientX-v.config.xOffset)/v.config.scale),n=Math.floor((t.clientY-v.config.yOffset)/v.config.scale),i=Math.max(0,Math.min(v.config.width-1,e)),o=Math.max(0,Math.min(v.config.height-1,n));if(e!==i||n!==o)return I(!1);var n=i<A?i:A,r=A<i?i:A,l=o<X?o:X,s=X<o?o:X;if(n===r&&l===s)return J=Y=null,I(!1);V(t);for(var a=n;a<=r;a++)for(var f=l;f<=s;f++)v.grid[f][a]=z;return I(!0)},V=function(t){if(null==A||null==X||null===z)return I(!1);var e=Math.floor((t.clientX-v.config.xOffset)/v.config.scale),n=Math.floor((t.clientY-v.config.yOffset)/v.config.scale),i=e<0||e>=v.config.width-1?A:e,t=n<0||n>=v.config.height-1?X:n;if(i!==Y||t!==J){for(var o=i<A?i:A,e=i<Y?i:Y,r=A<i?i:A,n=Y<i?i:Y,l=n<r?r:n,s=t<X?t:X,n=t<J?t:J,a=s<n?s:n,f=X<t?t:X,n=J<t?t:J,c=n<f?f:n,g=o<e?o:e;g<=l;g++)for(var u=a;u<=c;u++)B(g,u,o<=g&&g<=r&&s<=u&&u<=f?z:v.grid[u][g]);Y=i,J=t}};_=localStorage.getItem("width"),C=localStorage.getItem("height"),k=localStorage.getItem("game"),_&&(n.value=_),C&&(o.value=C),k&&(k=JSON.parse(k),l(k)),t.addEventListener("click",f,{once:!1,passive:!0}),i.addEventListener("click",F,{once:!1,passive:!0}),i.addEventListener("mousedown",N,{once:!1,passive:!0})},{once:!0,passive:!0});
//# sourceMappingURL=es5.js.map
